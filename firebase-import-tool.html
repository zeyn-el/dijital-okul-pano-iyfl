<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase AktarÄ±m AracÄ±</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <!-- Firebase Config -->
    <script src="firebase-config.js"></script>
</head>

<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen p-8">
    <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-2xl shadow-2xl p-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2 flex items-center gap-3">
                ğŸ”¥ Firebase Veri AktarÄ±m AracÄ±
            </h1>
            <p class="text-gray-600 mb-8">
                localStorage.txt dosyanÄ±zdaki verileri Firebase'e aktarÄ±n
            </p>

            <!-- Status Box -->
            <div id="statusBox" class="mb-6 p-6 bg-gray-50 rounded-xl border-2 border-gray-200">
                <p class="text-lg">
                    <span class="font-bold">Durum:</span>
                    <span id="statusText" class="text-gray-600">HazÄ±r</span>
                </p>
                <div id="progressBar" class="hidden mt-4 w-full bg-gray-200 rounded-full h-3">
                    <div id="progressFill" class="bg-blue-600 h-3 rounded-full transition-all duration-300"
                        style="width: 0%"></div>
                </div>
            </div>

            <!-- JSON Input Area -->
            <div class="mb-6">
                <label class="block text-sm font-bold text-gray-700 mb-2">
                    ğŸ“„ localStorage.txt Ä°Ã§eriÄŸini Buraya YapÄ±ÅŸtÄ±rÄ±n:
                </label>
                <textarea id="jsonInput" rows="15"
                    class="w-full p-4 border-2 border-gray-300 rounded-lg font-mono text-xs bg-slate-900 text-green-400 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none"
                    placeholder='{"schoolName": "...", "cards": {...}}'></textarea>
                <p class="text-sm text-gray-500 mt-2">
                    ğŸ’¡ localStorage.txt dosyasÄ±nÄ± bir metin editÃ¶rÃ¼nde aÃ§Ä±n, tÃ¼m iÃ§eriÄŸi kopyalayÄ±n ve yukarÄ±ya
                    yapÄ±ÅŸtÄ±rÄ±n.
                </p>
            </div>

            <!-- Action Buttons -->
            <div class="flex gap-4">
                <button onclick="validateJSON()"
                    class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-bold py-4 px-6 rounded-lg transition-all shadow-lg hover:shadow-xl">
                    ğŸ” JSON'u Kontrol Et
                </button>
                <button onclick="uploadToFirebase()"
                    class="flex-1 bg-orange-500 hover:bg-orange-600 text-white font-bold py-4 px-6 rounded-lg transition-all shadow-lg hover:shadow-xl">
                    ğŸš€ Firebase'e Aktar
                </button>
            </div>

            <!-- Info Box -->
            <div class="mt-8 p-4 bg-blue-50 border-l-4 border-blue-500 rounded">
                <h3 class="font-bold text-blue-900 mb-2">ğŸ“Œ KullanÄ±m TalimatlarÄ±:</h3>
                <ol class="list-decimal list-inside text-sm text-blue-800 space-y-1">
                    <li>localStorage.txt dosyasÄ±nÄ± bir metin editÃ¶rÃ¼nde aÃ§Ä±n</li>
                    <li>TÃ¼m iÃ§eriÄŸi kopyalayÄ±n (Ctrl+A, Ctrl+C)</li>
                    <li>YukarÄ±daki metin kutusuna yapÄ±ÅŸtÄ±rÄ±n (Ctrl+V)</li>
                    <li>"JSON'u Kontrol Et" butonuna tÄ±klayarak geÃ§erliliÄŸini kontrol edin</li>
                    <li>"Firebase'e Aktar" butonuna tÄ±klayarak yÃ¼kleyin</li>
                </ol>
            </div>
        </div>
    </div>

    <script>
        let parsedData = null;

        function updateStatus(message, type = 'info') {
            const statusText = document.getElementById('statusText');
            const statusBox = document.getElementById('statusBox');

            statusText.textContent = message;

            // Reset classes
            statusBox.className = 'mb-6 p-6 rounded-xl border-2';

            // Apply type-specific styling
            if (type === 'success') {
                statusBox.classList.add('bg-green-50', 'border-green-500');
                statusText.className = 'text-green-700 font-bold';
            } else if (type === 'error') {
                statusBox.classList.add('bg-red-50', 'border-red-500');
                statusText.className = 'text-red-700 font-bold';
            } else if (type === 'warning') {
                statusBox.classList.add('bg-yellow-50', 'border-yellow-500');
                statusText.className = 'text-yellow-700 font-bold';
            } else if (type === 'loading') {
                statusBox.classList.add('bg-blue-50', 'border-blue-500');
                statusText.className = 'text-blue-700 font-bold';
            } else {
                statusBox.classList.add('bg-gray-50', 'border-gray-200');
                statusText.className = 'text-gray-600';
            }
        }

        function showProgress(show = true) {
            const progressBar = document.getElementById('progressBar');
            if (show) {
                progressBar.classList.remove('hidden');
            } else {
                progressBar.classList.add('hidden');
            }
        }

        function setProgress(percent) {
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = percent + '%';
        }

        function validateJSON() {
            const input = document.getElementById('jsonInput').value.trim();

            if (!input) {
                updateStatus('âŒ LÃ¼tfen JSON verisini yapÄ±ÅŸtÄ±rÄ±n!', 'error');
                alert('Metin kutusu boÅŸ! LÃ¼tfen localStorage.txt iÃ§eriÄŸini yapÄ±ÅŸtÄ±rÄ±n.');
                return false;
            }

            try {
                parsedData = JSON.parse(input);

                // Validate structure
                const hasSchoolName = parsedData.schoolName ? 'âœ…' : 'âŒ';
                const hasCards = parsedData.cards ? 'âœ…' : 'âŒ';
                const dataSize = (JSON.stringify(parsedData).length / 1024).toFixed(2);

                updateStatus('âœ… JSON geÃ§erli! Boyut: ' + dataSize + ' KB', 'success');

                alert('âœ… JSON DoÄŸrulama BaÅŸarÄ±lÄ±!\n\n' +
                    'Okul AdÄ±: ' + hasSchoolName + ' ' + (parsedData.schoolName || 'Yok') + '\n' +
                    'Kartlar: ' + hasCards + '\n' +
                    'Toplam Boyut: ' + dataSize + ' KB\n\n' +
                    'Åimdi "Firebase\'e Aktar" butonuna tÄ±klayabilirsiniz.');

                return true;
            } catch (error) {
                updateStatus('âŒ GeÃ§ersiz JSON formatÄ±!', 'error');
                alert('âŒ JSON HatasÄ±!\n\n' + error.message + '\n\nLÃ¼tfen localStorage.txt dosyasÄ±nÄ±n tamamÄ±nÄ± kopyaladÄ±ÄŸÄ±nÄ±zdan emin olun.');
                return false;
            }
        }

        async function uploadToFirebase() {
            // First validate
            if (!parsedData) {
                const isValid = validateJSON();
                if (!isValid) return;
            }

            if (!confirm('âš ï¸ DÄ°KKAT!\n\nBu iÅŸlem Firebase\'deki mevcut verilerin ÃœZERÄ°NE YAZACAKTIR.\n\nDevam etmek istediÄŸinizden emin misiniz?')) {
                return;
            }

            try {
                updateStatus('ğŸ”„ Firebase\'e baÄŸlanÄ±lÄ±yor...', 'loading');
                showProgress(true);
                setProgress(10);

                // Normalize data structure to match current system
                const normalizedData = {
                    schoolName: parsedData.schoolName || "OKUL ADI GÄ°RÄ°NÄ°Z",
                    cards: {
                        // Birthday data
                        birthdays: parsedData.cards?.birthdays || parsedData.cards?.birthday || {
                            enabled: true,
                            title: "Ä°yi ki doÄŸdun!",
                            students: []
                        },

                        // Duty teachers
                        duty: parsedData.cards?.duty || { list: [] },
                        dutyByDate: parsedData.cards?.dutyByDate || { items: [] },

                        // YKS countdown
                        yks: parsedData.cards?.yks || {
                            enabled: true,
                            title: "YKS'ye Kalan",
                            date: ""
                        },

                        // Info card
                        info: parsedData.cards?.info || {
                            enabled: true,
                            items: [],
                            sliderSpeed: 5
                        },

                        // Media center
                        mediaCenter: parsedData.cards?.mediaCenter || parsedData.cards?.mainMedia || {
                            type: "slideshow",
                            images: [],
                            speed: 5
                        },

                        // Quotes
                        quotes: parsedData.cards?.quotes || parsedData.cards?.quote || {
                            title: "GÃ¼nÃ¼n SÃ¶zÃ¼",
                            items: [],
                            enableSlider: false,
                            sliderSpeed: 8
                        },

                        // Ticker
                        ticker: parsedData.cards?.ticker || {
                            text: "",
                            speed: 20
                        },

                        // Schedule
                        schedule: parsedData.cards?.schedule || { items: [] },

                        // Time plan
                        timePlan: parsedData.cards?.timePlan || { items: [] }
                    }
                };

                setProgress(30);
                updateStatus('ğŸ“¤ Veriler Firebase\'e yÃ¼kleniyor...', 'loading');

                // Upload to Firebase
                await firebase.database().ref('panoData').set(normalizedData);

                setProgress(70);
                updateStatus('ğŸ’¾ LocalStorage gÃ¼ncelleniyor...', 'loading');

                // Also update localStorage
                localStorage.setItem('panoData', JSON.stringify(normalizedData));

                setProgress(100);
                updateStatus('âœ… AktarÄ±m baÅŸarÄ±yla tamamlandÄ±!', 'success');

                setTimeout(function () {
                    showProgress(false);
                }, 2000);

                const dataSize = (JSON.stringify(normalizedData).length / 1024).toFixed(2);
                alert('ğŸ‰ BaÅŸarÄ±lÄ±!\n\n' +
                    'Verileriniz Firebase\'e baÅŸarÄ±yla aktarÄ±ldÄ±.\n\n' +
                    'AktarÄ±lan Veri Boyutu: ' + dataSize + ' KB\n' +
                    'Okul AdÄ±: ' + normalizedData.schoolName + '\n\n' +
                    'Åimdi admin.html veya index.html sayfasÄ±nÄ± yenileyerek verilerinizi gÃ¶rebilirsiniz.');

            } catch (error) {
                console.error('Upload error:', error);
                updateStatus('âŒ YÃ¼kleme hatasÄ±: ' + error.message, 'error');
                showProgress(false);
                alert('âŒ Firebase YÃ¼kleme HatasÄ±!\n\n' + error.message + '\n\nÄ°nternet baÄŸlantÄ±nÄ±zÄ± kontrol edin ve tekrar deneyin.');
            }
        }

        // Auto-focus on text area
        window.addEventListener('load', function () {
            document.getElementById('jsonInput').focus();
            updateStatus('HazÄ±r - localStorage.txt iÃ§eriÄŸini yapÄ±ÅŸtÄ±rÄ±n', 'info');
        });
    </script>
</body>

</html>